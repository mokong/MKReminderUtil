# MKReminderUtil
æ³•å®šèŠ‚å‡æ—¥æ—¥å†æé†’

# [iOS å·¥ä½œæ—¥â€”â€”è¿‡æ»¤æ³•å®šèŠ‚å‡æ—¥æ—¥å†æé†’çš„å®ç°](https://morganwang.cn/)

## èƒŒæ™¯

ç¬”è€…äº”ä¸€ä¹‹å‰è¡¥ç­çš„æ—¶å€™ï¼Œé—¹é’Ÿæ²¡å“ï¼Œæ—©ä¸Šå·®ç‚¹è¿Ÿåˆ°äº†ã€‚ç¬”è€…é—¹é’Ÿè®¾ç½®çš„æ˜¯å‘¨ä¸€åˆ°å‘¨äº”ï¼ŒiPhoneæ²¡æœ‰æ³•å®šèŠ‚å‡æ—¥çš„è®¾ç½®ï¼Œä¹Ÿæ²¡æœ‰è¡¥ä¼‘çš„è®¾ç½®ã€‚ã€‚ã€‚ã€‚ç¬”è€…å°±æƒ³è¦è§£å†³è¿™ä¸ªç—›ç‚¹ï¼Œæ¢¦æƒ³ç€ï¼Œè¦æ˜¯åšå‡ºæ¥äº†ï¼Œå‘å¸ƒåˆ°å•†åº—ï¼Œä»æ­¤èµ°ä¸Šäººç”Ÿå·…å³°ï¼Œèµ¢å–ç™½ã€‚ã€‚ã€‚ã€‚

<!--more-->

YYè¿‡åï¼Œå›è¿‡å¤´æ¥ï¼Œæ¥ç€è°ƒç ”ï¼Œæ³•å®šèŠ‚å‡æ—¥é—¹é’Ÿçš„å®ç°ï¼Œç¬”è€…æŸ¥æ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œå‘ç°ä¸ç”¨åšæ¢¦äº†ã€‚é¦–å…ˆiOSç¨‹åºæ·»åŠ é—¹é’Ÿåˆ°æ—¶é’ŸAPPæ˜¯ä¸å…è®¸çš„ã€‚ã€‚ã€‚å…¶æ¬¡ï¼ŒiOSä¹Ÿæ²¡æœ‰æ³•å®šèŠ‚å‡æ—¥çš„åˆ¤æ–­ã€‚ã€‚ã€‚ã€‚æ‰€ä»¥ä¸ç”¨YYäº†ã€‚ä½†æ˜¯ç¬”è€…è¿˜çœŸæ‰¾åˆ°äº†[iOSè‡ªå®šä¹‰é—¹é’Ÿ â€”â€” ä¸­å›½æ³•å®šèŠ‚å‡æ—¥(å‡çº§ç‰ˆï¼‰](https://zhuanlan.zhihu.com/p/138316230)è¿™ä¸ªï¼Œé€šè¿‡å¿«æ·æŒ‡ä»¤è‡ªå®šä¹‰é—¹é’Ÿï¼Œå¯ä»¥å®ç°è¿‡æ»¤æ³•å®šèŠ‚å‡æ—¥ã€‚åŸç†æ˜¯ï¼šè®¾ç½®é—¹é’Ÿï¼Œç„¶åé€šè¿‡å¿«æ·æŒ‡ä»¤çš„è‡ªåŠ¨æ‰§è¡Œï¼Œæ¯å¤©åœ¨é—¹é’Ÿæ—¶é—´å‰ï¼Œé€šè¿‡è®¢é˜…çš„åˆ«äººç»´æŠ¤çš„æ—¥å†æˆ–è€…è‡ªå·±æœ¬åœ°ç»´æŠ¤æ—¥å†ï¼Œåˆ¤æ–­å½“å¤©æ˜¯å¦æ˜¯èŠ‚å‡æ—¥ï¼Œç„¶åå†³å®šå½“å¤©çš„é—¹é’Ÿæ˜¯å¦æ‰“å¼€ã€å…³é—­ã€‚ç¬”è€…ä¸å¾—ä¸èµä¸€ä¸ªï¼ŒçœŸçš„ä¼˜ç§€ã€‚

è™½ç„¶ç¬”è€…çš„å‘è´¢æ¢¦å¤­æŠ˜äº†ã€‚ã€‚ã€‚ä½†ç¬”è€…æƒ³åˆ°äº†å¦ä¸€ä¸ªï¼Œè™½ç„¶iOSç¨‹åºä¸èƒ½ç›´æ¥æ·»åŠ é—¹é’Ÿï¼Œä½†æ˜¯iOSç¨‹åºå¯ä»¥ç›´æ¥æ·»åŠ æ—¥å†æé†’å•Šï¼Œæ¯”å¦‚é¢„çº¦ç›´æ’­æˆ–è€…é¢„çº¦æŠ¢è´­çš„ï¼Œå…¶å®éƒ½æ˜¯æ·»åŠ äº‹ä»¶åˆ°æ—¥å†ä¸­ï¼Œç„¶ååœ¨æŒ‡å®šçš„æ—¶é—´ï¼Œå¼¹å‡ºæ¥æ—¥å†æé†’å»åšä»€ä¹ˆï¼Œä¹Ÿä¸æ˜¯ä¸å¯ä»¥ç”¨ã€‚é‚£æ˜¯å¦èƒ½ç”¨æ—¥å†æé†’æ¥å®ç°ï¼Œæ³•å®šå·¥ä½œæ—¥çš„æé†’å‘¢ã€‚ã€‚ã€‚æ¯”å¦‚æ¯ä¸ªå·¥ä½œæ—¥æé†’æ‰“å¡ã€‚æˆ–è€…åªé’ˆå¯¹èŠ‚å‡æ—¥è¡¥ç­æé†’ï¼Œæ¯ä¸ªè¡¥ç­å‰å¤©æ™šä¸Šæé†’è®¾ç½®é—¹é’Ÿã€‚

## å®ç°

iPhone æ·»åŠ æ—¥å†æé†’çš„å®ç°å¾ˆç®€å•ï¼Œéš¾çš„åœ°æ–¹è¿˜æ˜¯åœ¨äºå›½å†…æ³•å®šèŠ‚å‡æ—¥çš„åˆ¤æ–­ï¼Œæ€ä¹ˆèƒ½è¿‡æ»¤æ‰æ³•å®šèŠ‚å‡æ—¥ï¼Œå®ç°çœŸæ­£çº¯å·¥ä½œæ—¥çš„æ—¶å€™æé†’ï¼Ÿ


### ç¬¬ä¸€æ­¥ï¼Œå…ˆåˆ›å»ºå‘¨ä¸€åˆ°å‘¨äº”çš„é‡å¤äº‹ä»¶

ç¬”è€…åˆè°ƒç ”äº†ä¸€ç•ªï¼Œå‘ç°æ—¥å†æé†’ä¸­æœ‰ä¸€ä¸ª`EKRecurrenceRule`çš„è§„åˆ™é€‰é¡¹ï¼Œæ˜¯å¦èƒ½ç”¨è¿™ä¸ªæ¥å®ç°å‘¢ï¼Ÿ

[EKRecurrenceRule](https://developer.apple.com/documentation/eventkit/ekrecurrencerule)æ˜¯ä»€ä¹ˆï¼Ÿ

å®˜æ–¹è§£é‡Šï¼š
> A class that describes the recurrence pattern for a recurring event.

ç¬”è€…ç†è§£ï¼š
é‡å¤äº‹ä»¶çš„é‡å¤è§„åˆ™ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯å®šä¹‰ä¸€ä¸ªé‡å¤è§„åˆ™ï¼Œæ¯”å¦‚æ¯å‘¨é‡å¤ã€æ¯å¤©é‡å¤ã€æ¯éš”å‡ å¤©é‡å¤ç±»ä¼¼çš„ï¼Œç„¶åæŒ‰ç…§è¿™ä¸ªè§„åˆ™æ·»åŠ äº‹ä»¶ã€‚

çœ‹åˆ°è¿™ä¸ªï¼Œç¬”è€…çš„å¿ƒå‡‰äº†åŠæˆªï¼Œé‡å¤çš„è§„åˆ™ï¼Œå¯¹äºå›½å†…æ³•å®šèŠ‚å‡æ—¥æ¥è¯´ã€‚ã€‚ã€‚ã€‚é™¤äº†äº”ä¸€ã€å›½åº†ã€å…ƒæ—¦ä¹‹å¤–ï¼Œå†œå†çš„èŠ‚æ—¥é‡å¤çš„è§„åˆ™æ‰¾ä¸åˆ°ã€‚ã€‚ã€‚æ€ä¹ˆåŠï¼Ÿç¬”è€…å¯»æ€ç€éƒ½åˆ°è¿™ä¸€æ­¥äº†ï¼Œå°±å…ˆåšä¸ªå‘¨ä¸€åˆ°å‘¨äº”çš„ï¼Œä¹Ÿç®—æ˜¯éœ€æ±‚å®Œæˆäº†åŠä¸ªï¼Œå·¥ä½œæ—¥çš„é‚£éƒ¨åˆ†å®Œæˆäº†ï¼Œå‰©ä¸‹çš„é‚£éƒ¨åˆ†è¿‡æ»¤æ³•å®šèŠ‚å‡æ—¥å’Œè¡¥ä¼‘ï¼Œæ…¢æ…¢çœ‹ï¼Œåˆä¸æ˜¯ä¸ç”¨ğŸ˜‚

å…ˆæ¥çœ‹è®¾ç½®æ¯å‘¨ä¸€åˆ°å‘¨äº”çš„å¾ªç¯æ—¥å†äº‹ä»¶
 
**æ·»åŠ æ—¥å†äº‹ä»¶**
æ·»åŠ æ—¥å†äº‹ä»¶çš„æ­¥éª¤å¦‚ä¸‹ï¼š
1. è·å–è¯»å†™æ—¥å†æƒé™
2. åˆ›å»ºå•ç‹¬çš„æ—¥å†
3. ç”Ÿæˆå‘¨ä¸€åˆ°å‘¨äº”çš„è§„åˆ™
4. æ ¹æ®æ ‡é¢˜ã€åœ°å€ã€è§„åˆ™å’Œæ—¶é—´ç”Ÿæˆæ—¥å†äº‹ä»¶
5. æ·»åŠ äº‹ä»¶åˆ°æ—¥å† åˆ¤æ–­ç”Ÿæˆçš„äº‹ä»¶æ˜¯å¦å·²ç»æ·»åŠ ï¼Œå·²æ·»åŠ åˆ™ä¸æ“ä½œï¼Œæ²¡æ·»åŠ åˆ™æ·»åŠ 

ä¸‹é¢ä¸€æ­¥æ­¥æ¥çœ‹ï¼š

1. è·å–è¯»å†™æ—¥å†æƒé™

    é¦–å…ˆéœ€è¦åœ¨plistä¸­æ·»åŠ `Privacy - Calendars Usage Description`æƒé™ï¼Œç„¶åä½¿ç”¨ä¸‹é¢ä»£ç ç”³è¯·æƒé™

    ``` Swift

    lazy fileprivate var store = EKEventStore()
    
    // MARK: utils
    // ç”³è¯·æ—¥å†æƒé™
    func requestEventAuth(_ callback:((Bool) -> Void)?) {
        store.requestAccess(to: EKEntityType.event) { granted, error in
            callback?(granted)
        }
    }

    ```


2. åˆ›å»ºå•ç‹¬çš„æ—¥å†
    
    ç”¨äºä¿è¯ä¸å’Œå…¶å®ƒæ—¥å†å†²çªï¼Œè€Œä¸”ä¸æ˜¾ç¤ºæˆ–è€…ç§»é™¤æ—¶æ–¹ä¾¿ï¼Œå»ºè®®æ¯ä¸ªè‡ªå®šä¹‰æ—¥å†äº‹ä»¶çš„éƒ½å•ç‹¬å®šä¹‰ä¸€ä¸ªæ—¥å†ã€‚
    
    å¬èµ·æ¥æœ‰äº›ç»•ï¼Œæ‰“å¼€iPhoneï¼Œæ‰“å¼€æ—¥å†ï¼Œç„¶åç‚¹å‡»åº•éƒ¨ä¸­é—´çš„æ—¥å†æŒ‰é’®ï¼Œå°±èƒ½çœ‹åˆ°è‡ªå·±çš„æ‰€æœ‰æ—¥å†ã€‚çœ‹å›¾å¦‚ä¸‹ï¼Œ"è‡ªå®šä¹‰çš„äº‹é¡¹æ—¥å†"å³æ˜¯ç¬”è€…è‡ªå®šä¹‰çš„æ—¥å†ï¼Œç¬”è€…æ‰€æ·»åŠ çš„æ—¥å†äº‹ä»¶éƒ½ä¼šåœ¨è¿™ä¸ªæ—¥å†ä¸­ï¼Œå¦‚æœä¸æƒ³è¦çœ‹åˆ°è¿™äº›äº‹ä»¶ï¼Œå¯ä»¥ç›´æ¥æŠŠå‰é¢çš„å‹¾é€‰å»é™¤ï¼Œæ—¥å†ä¸­å°±ä¸ä¼šæ˜¾ç¤ºè‡ªå®šä¹‰çš„æ—¥å†äº‹ä»¶äº†ã€‚æˆ–è€…æƒ³è¦åˆ é™¤è¿™ä¸ªæ—¥å†ä¸­çš„æ‰€æœ‰äº‹ä»¶æ—¶ï¼Œåªéœ€è¦æŠŠè¿™ä¸ªæ—¥å†åˆ æ‰å³å¯ï¼Œä¸éœ€è¦ä¸€æ¡æ¡äº‹ä»¶åˆ é™¤ï¼Œç‚¹å‡»å³è¾¹çš„æç¤ºæŒ‰é’®ï¼Œç„¶åæ»‘åŠ¨åˆ°æœ€ä¸‹æ–¹å°±æœ‰åˆ é™¤æ—¥å†çš„æŒ‰é’®ã€‚

    Psï¼šé»˜é»˜çš„åæ§½ï¼Œä¸çŸ¥é“ä¸ºå•¥é¢„çº¦æŠ¢è´­å’Œé¢„çº¦ç›´æ’­æé†’çš„ï¼Œä¸å•ç‹¬å»ºä¸€ä¸ªæ—¥å†ã€‚ã€‚ã€‚ã€‚ç¬”è€…é¢„çº¦äº†ä¹‹åæ„Ÿè§‰çƒ¦ï¼Œæ¯æ¬¡éƒ½å¾—æ‰‹åŠ¨å»åˆ é™¤äº‹ä»¶

    <img src="https://i.loli.net/2021/05/13/S9Hgadze8hlPAYD.jpg" width="50%" height='50%'>

    åˆ›å»ºæ—¥å†çš„ä»£ç å¦‚ä¸‹ï¼Œæ³¨æ„calendarçš„sourceçš„è®¾ç½®ï¼Œsourceè®¾ç½®ä¸ºä»€ä¹ˆï¼Œæœ€åæ·»åŠ çš„æ—¥å†ä¼šæ˜¾ç¤ºåœ¨å“ªä¸ªåœ°æ–¹

   ``` ObjectiveC

    // åˆ›å»ºæ–°çš„æ—¥å†
    func createNewCalendar() {
        guard let calendarId = MKCalendarReminderUtil.userDefaultsSaveStr(kCustomCalendarId),
              let _ = store.calendar(withIdentifier: calendarId) else { // è¯´æ˜æœ¬åœ°å·²ç»åˆ›å»ºäº†å½“å‰æ—¥å†
            return
        }
        
        let calendar = EKCalendar(for: EKEntityType.event, eventStore: store)
        for item in store.sources {
            if item.title == "iCloud" || item.title == "Default" {
                calendar.source = item
                break
            }
        }
        
        calendar.title = "è‡ªå®šä¹‰çš„äº‹é¡¹æ—¥å†" // è‡ªå®šä¹‰æ—¥å†æ ‡é¢˜
        calendar.cgColor = UIColor.systemPurple.cgColor // è‡ªå®šä¹‰æ—¥å†é¢œè‰²
        
        do {
            try store.saveCalendar(calendar, commit: true)
            MKCalendarReminderUtil.saveToUserDefaults(kCustomCalendarId, valueStr: calendar.calendarIdentifier)
        }
        catch {
            print(error)
        }
    }

   ```

3. ç”Ÿæˆå‘¨ä¸€åˆ°å‘¨äº”çš„è§„åˆ™
   
   ä½¿ç”¨`EKRecurrenceRule`ç”Ÿæˆæ¯å‘¨ä¸€åˆ°å‘¨äº”é‡å¤çš„è§„åˆ™ã€‚`EKRecurrenceRule`çš„ä½¿ç”¨å¦‚ä¸‹ï¼Œå…¶ä¸­`EKRecurrenceRule(recurrenceWith:interval:daysOfTheWeek:daysOfTheMonth:monthsOfTheYear:weeksOfTheYear:daysOfTheYear:setPositions:end:)`åˆå§‹åŒ–æ–¹æ³•å„å‚æ•°æ„ä¹‰å¦‚ä¸‹:

   - recurrenceWith: EKRecurrenceFrequency, ä»£è¡¨é‡å¤é¢‘ç‡ï¼Œå¯è®¾ç½®ï¼šæŒ‰å¤©ã€å‘¨ã€æœˆã€å¹´çš„é‡å¤é¢‘ç‡
   - interval: Int, ä»£è¡¨é‡å¤é—´éš”ï¼Œæ¯ä¸ªå¤šä¹…é‡å¤ï¼Œä¸èƒ½ä¸º0
   - daysOfTheWeek: [EKRecurrenceDayOfWeek], æ¯å‘¨å“ªå‡ å¤©é‡å¤ï¼Œè®¾ç½®ä¹‹åï¼Œé™¤äº†æŒ‰å¤©çš„é‡å¤é¢‘ç‡å¤–ï¼Œéƒ½å¯ä»¥ç”Ÿæ•ˆ
   - daysOfTheMonth: [number], numberå–å€¼1-31ï¼Œä¹Ÿå¯ä»¥ä¸ºè´Ÿæ•°ï¼Œè´Ÿæ•°è¯´æ˜æ˜¯ä»æœˆåº•å¼€å§‹ï¼Œæ¯”å¦‚-1æ˜¯è¯¥æœˆæœ€åä¸€å¤©ã€‚åªæœ‰åœ¨è®¾ç½®äº†æŒ‰æœˆé‡å¤é¢‘ç‡ä¸‹ç”Ÿæ•ˆ
   - monthsOfTheYear: [number], numberå–å€¼1-12ï¼Œåªæœ‰åœ¨è®¾ç½®äº†æŒ‰å¹´é‡å¤é¢‘ç‡ä¸‹ç”Ÿæ•ˆ
   - weeksOfTheYear: [number], numberå–å€¼1-53ï¼Œä¹Ÿå¯ä»¥ä¸ºè´Ÿæ•°ï¼Œè´Ÿæ•°è¯´æ˜æ˜¯ä»å¹´åº•å¼€å§‹ã€‚åªæœ‰åœ¨è®¾ç½®äº†æŒ‰å¹´é‡å¤é¢‘ç‡ä¸‹ç”Ÿæ•ˆ
   - daysOfTheYear: [number], numberå–å€¼1-366ï¼Œä¹Ÿå¯ä»¥ä¸ºè´Ÿæ•°ï¼Œè´Ÿæ•°è¯´æ˜æ˜¯ä»å¹´åº•å¼€å§‹ã€‚åªæœ‰åœ¨è®¾ç½®äº†æŒ‰å¹´é‡å¤é¢‘ç‡ä¸‹ç”Ÿæ•ˆ
   - setPositions: [number], numberå–å€¼1-366ï¼Œä¹Ÿå¯ä»¥ä¸ºè´Ÿæ•°ï¼Œè´Ÿå€¼è¡¨ç¤ºåå‘è®¡ç®—ï¼Œè¿‡æ»¤å…¶å®ƒè§„åˆ™çš„è¿‡æ»¤å™¨ï¼Œåœ¨è®¾ç½®äº†daysOfTheWeek, daysOfTheMonth, monthsOfTheYear, weeksOfTheYear, daysOfTheYear ä¹‹åæœ‰æ•ˆ
   - end: EKRecurrenceEnd, é‡å¤æˆªæ­¢æ—¥æœŸ

   ``` Swift

    // ç”Ÿæˆé‡å¤çš„è§„åˆ™
    func generateEKRecurrenceRule() -> EKRecurrenceRule {
        let monday = EKRecurrenceDayOfWeek(EKWeekday.monday)
        let tuesday = EKRecurrenceDayOfWeek(EKWeekday.tuesday)
        let wednesday = EKRecurrenceDayOfWeek(EKWeekday.wednesday)
        let thursday = EKRecurrenceDayOfWeek(EKWeekday.thursday)
        let friday = EKRecurrenceDayOfWeek(EKWeekday.friday)
        
        // è®¾ç½®æŒ‰é‡å¤é¢‘ç‡ä¸ºæŒ‰å‘¨é‡å¤ï¼Œé‡å¤é—´éš”ä¸ºæ¯å‘¨éƒ½é‡å¤ï¼Œä¸€å‘¨ä¸­çš„å‘¨ä¸€ã€å‘¨äºŒã€å‘¨ä¸‰ã€å‘¨å››ã€å‘¨äº”é‡å¤
        let rule = EKRecurrenceRule(recurrenceWith: EKRecurrenceFrequency.weekly,
                                    interval: 1,
                                    daysOfTheWeek: [monday, tuesday, wednesday, thursday, friday],
                                    daysOfTheMonth: nil,
                                    monthsOfTheYear: nil,
                                    weeksOfTheYear: nil,
                                    daysOfTheYear: nil,
                                    setPositions: nil,
                                    end: nil)
        return rule
    }

   ```

4. æ ¹æ®æ ‡é¢˜ã€åœ°å€ã€å¤‡æ³¨ã€è§„åˆ™å’Œæ—¶é—´ç”Ÿæˆæ—¥å†äº‹ä»¶

    ç”Ÿæˆæ—¥å†äº‹ä»¶æ—¶ï¼Œè¦æ³¨æ„äº‹ä»¶çš„æŒç»­æ—¶é—´ï¼Œä»¥åŠæ˜¯å¦æ·»åŠ é—¹é’Ÿæç¤ºã€‚è¿™ä¸ªé—¹é’Ÿæç¤ºä¸æ˜¯é€šå¸¸æ„ä¹‰çš„é—¹é’Ÿï¼Œæ˜¯æ—¥ç¨‹æé†’ï¼Œæ¯”å¦‚è®¾ç½®äº†äº‹ä»¶çš„é—¹é’Ÿæç¤ºï¼Œåœ¨è¾¾åˆ°é—¹é’Ÿæé†’æ—¶é—´åï¼Œä¼šæé†’å“é“ƒï¼Œä¸”åœ¨é€šçŸ¥æ å¼¹å‡ºã€‚

    ``` Swift

    // ç”Ÿæˆæ—¥å†äº‹ä»¶
    func generateEvent(_ title: String?, location: String?, notes: String?, timeStr: String?) -> EKEvent {
        let event = EKEvent(eventStore: store)
        event.title = title
        event.location = location
        event.notes = notes
        
        // äº‹ä»¶çš„æ—¶é—´
        if let date = Date.date(from: timeStr, formatterStr: "yyyy-MM-dd HH:mm:ss") {
            // å¼€å§‹
            let startDate = Date(timeInterval: 0, since: date)
            // ç»“æŸ
            let endDate = Date(timeInterval: 60, since: date)
            
            // æ—¥å†æé†’æŒç»­æ—¶é—´
            event.startDate = startDate
            event.endDate = endDate
            event.isAllDay = false
        }
        else {
            // å…¨å¤©æé†’
            event.isAllDay = true
        }

        // æ·»åŠ é‡å¤è§„åˆ™
        let recurrenceRule = generateEKRecurrenceRule()
        event.addRecurrenceRule(recurrenceRule)

        // æ·»åŠ é—¹é’Ÿç»“åˆï¼ˆå¼€å§‹å‰å¤šå°‘ç§’ï¼‰è‹¥ä¸ºæ­£åˆ™æ˜¯å¼€å§‹åå¤šå°‘ç§’ã€‚
        let alarm = EKAlarm(relativeOffset: 0)
        event.addAlarm(alarm)
        
        if let calendarId = MKCalendarReminderUtil.userDefaultsSaveStr(kCustomCalendarId),
           let calendar = store.calendar(withIdentifier: calendarId) {
            event.calendar = calendar
        }
        
        return event
    }

    ```

5. æ·»åŠ äº‹ä»¶åˆ°æ—¥å† 
    
    æ·»åŠ æ—¶ï¼Œéœ€è¦åˆ¤æ–­ç”Ÿæˆçš„äº‹ä»¶æ˜¯å¦å·²ç»æ·»åŠ ï¼Œå·²æ·»åŠ åˆ™ä¸æ“ä½œï¼Œæ²¡æ·»åŠ åˆ™æ·»åŠ ã€‚æ·»åŠ æˆåŠŸåï¼ŒæŠŠäº‹ä»¶IDå­˜å‚¨èµ·æ¥ï¼Œé¿å…é‡å¤æ·»åŠ åŒä¸€ä¸ªäº‹ä»¶

    ``` Swift

        // æ·»åŠ äº‹ä»¶åˆ°æ—¥å†
    func addEvent(_ title: String?, location: String?, notes: String?, timeStr: String, eventKey: String) {
        requestEventAuth { [weak self] granted in
            if granted {
                // å…ˆåˆ›å»ºæ—¥å†
                self?.createNewCalendar()
                
                // åˆ¤æ–­äº‹ä»¶æ˜¯å¦å­˜åœ¨
                if let eventId = MKCalendarReminderUtil.userDefaultsSaveStr(eventKey),
                   let _ = self?.store.event(withIdentifier: eventId) {
                    // äº‹ä»¶å·²æ·»åŠ 
                    return
                }
                else {
                    if let event = self?.generateEvent(title, location: location, notes: notes, timeStr: timeStr) {
                        do {
                            try self?.store.save(event, span: EKSpan.thisEvent, commit: true)
                            //æ·»åŠ æˆåŠŸåéœ€è¦ä¿å­˜æ—¥å†å…³é”®å­—
                            // ä¿å­˜åœ¨æ²™ç›’ï¼Œé¿å…é‡å¤æ·»åŠ ç­‰å…¶ä»–åˆ¤æ–­
                            MKCalendarReminderUtil.saveToUserDefaults(eventKey, valueStr: event.eventIdentifier)
                        }
                        catch {
                            print(error)
                        }
                    }
                }
            }
        }
    }

    ```

ä»å¤–éƒ¨ä½¿ç”¨ä¸‹é¢ä»£ç è°ƒç”¨

``` Swift

let date = Date.beijingDate()
let timeStr = Date.string(from: date, formatterStr: "yyyy-MM-dd HH:mm:ss")
MKCalendarReminderUtil.util.addEvent("è‡ªå®šä¹‰æ ‡é¢˜", location: "ä¸Šæµ·ä¸œæ–¹æ˜ç ", notes: "è®°å¾—æ‹ç…§æ‰“å¡", timeStr: timeStr!, eventKey: "è‡ªå®šä¹‰æ ‡é¢˜")

```

ä¼šå…ˆå¼¹å‡ºæˆæƒè®¿é—®æ—¥å†çš„æç¤ºæ¡†ï¼Œç‚¹å‡»å…è®¸åï¼ŒæˆåŠŸæ·»åŠ åˆ°æ—¥å†ï¼Œç„¶åå»æ—¥å†ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ—¥å†ä¸­ä»å½“å¤©å¼€å§‹çš„ï¼Œæ¯å‘¨ä¸€è‡³å‘¨äº”éƒ½æœ‰äº‹ä»¶å­˜åœ¨

<img src="https://i.loli.net/2021/05/14/VLlRoFKw43rXynp.png" width="50%" height="50%">

ç‚¹å¼€å…·ä½“çš„æ—¥æœŸï¼Œå¯ä»¥çœ‹åˆ°å½“å¤©æ—¥æœŸçš„æ‰€æœ‰äº‹ä»¶ï¼Œç‚¹å‡»æ·»åŠ çš„äº‹ä»¶

<img src="https://i.loli.net/2021/05/14/Fp3boaxTlgi2sJk.png" width="50%" height="50%">

å¯ä»¥çœ‹åˆ°äº‹ä»¶çš„æ ‡é¢˜ã€åœ°å€ã€æŒç»­æ—¶é—´ã€é‡å¤é¢‘ç‡ã€æ‰€å±æ—¥å†ä»¥åŠå¤‡æ³¨

<img src="https://i.loli.net/2021/05/14/DqMHQONuJGRz8yV.png" width="50%" height="50%">


è‡³æ­¤ï¼Œç¬”è€…ä»¥åŠæˆåŠŸæ·»åŠ äº†å‘¨ä¸€åˆ°å‘¨äº”é‡å¤æé†’çš„äº‹ä»¶ï¼Œå·²ç»ç®—æ˜¯å®Œæˆäº†ä¸€åŠï¼Œå‹‰å¼ºèƒ½ç”¨ï¼Œå°±æ˜¯é‡åˆ°èŠ‚å‡æ—¥æ—¶ï¼Œè¡¥ç­ã€è°ƒä¼‘çš„æ—¶å€™ä¼šé”™è¯¯æé†’ã€‚æ‰€ä»¥è¿˜æœ‰åé¢çš„ä¸€èˆ¬ï¼Œæ€ä¹ˆæŠŠèŠ‚å‡æ—¥çš„é€»è¾‘åŠ å…¥åˆ°äº‹ä»¶ä¸­ï¼Ÿ


### ç¬¬äºŒæ­¥ï¼Œæ·»åŠ æ³•å®šèŠ‚å‡æ—¥é€»è¾‘

ç¬”è€…ä¸€ç›´æƒ³çš„æ˜¯æ·»åŠ æ³•å®šèŠ‚å‡æ—¥çš„é€»è¾‘ï¼Œä¸€å¼€å§‹å…¶å®å°±é™·å…¥äº†è¯¯åŒºï¼Œä¸€ç›´æƒ³çš„æ˜¯ï¼Œæ˜¯å¦æœ‰ä¸€ä¸ªè§„åˆ™ï¼ŒæŒ‰ç…§è¿™ä¸ªè§„åˆ™ï¼Œèƒ½è‡ªåŠ¨è¿‡æ»¤æ‰èŠ‚å‡æ—¥å’Œæ·»åŠ è¡¥ç­ï¼Œç„¶åç”Ÿæˆé‡å¤æ—¥å†äº‹ä»¶ã€‚ç„¶è€Œå¹¶æ²¡æœ‰è¿™æ ·çš„è§„åˆ™å­˜åœ¨ã€‚

å‚è€ƒå¿«æ·æŒ‡ä»¤èŠ‚å‡æ—¥é—¹é’Ÿçš„å®ç°ï¼Œç¬”è€…å°±æƒ³åˆ°äº†å¦ä¸€ç§æ–¹å¼ï¼Œå¦‚æœæ²¡æœ‰ç›´æ¥èŠ‚å‡æ—¥çš„è§„åˆ™ï¼Œé‚£èƒ½å¦åˆ†ä¸¤æ­¥èµ°ï¼Ÿç¬¬ä¸€æ­¥å…ˆåˆ›å»ºå‘¨ä¸€åˆ°å‘¨äº”çš„å›ºå®šé‡å¤é€»è¾‘ï¼›ç¬¬äºŒæ­¥ï¼Œä»æŸä¸ªåœ°æ–¹è·å–åˆ°èŠ‚å‡æ—¥å’Œè¡¥ç­ä¿¡æ¯ï¼Œç„¶åæ ¹æ®ä¿¡æ¯ï¼Œåœ¨ç¬¬ä¸€æ­¥çš„åŸºç¡€ä¸Šï¼Œâ€œå¤šé€€å°‘è¡¥â€ï¼Œå³å±äºèŠ‚å‡æ—¥çš„å‘¨ä¸€è‡³å‘¨äº”çš„äº‹ä»¶ç§»é™¤ï¼Œå±äºè¡¥ç­çš„æ²¡æœ‰æ—¥å†äº‹ä»¶çš„åˆ™æ·»åŠ äº‹ä»¶ã€‚

é‚£è¿™ç§æ–¹æ¡ˆæ˜¯å¦å¯è¡Œå‘¢ï¼Ÿå®è·µå‡ºçœŸçŸ¥ï¼

æ­¥éª¤å¦‚ä¸‹ï¼š

1. è·å–èŠ‚å‡æ—¥å’Œè¡¥ç­ä¿¡æ¯
    ä»å“ªé‡Œèƒ½è·å–åˆ°èŠ‚å‡æ—¥å’Œè¡¥ç­ä¿¡æ¯å‘¢ï¼Ÿç¬”è€…å»ç½‘ä¸ŠæŸ¥æ‰¾äº†ä¸€ç•ªï¼Œæœ€ç»ˆçœ‹åˆ°äº†æœ‰ä¸¤ä¸ªåˆé€‚çš„è®¢é˜…æ¥æº[holiday-cn](https://github.com/NateScarlet/holiday-cn)å’Œ[èŠ‚å‡æ—¥ API](http://timor.tech/api/holiday)ï¼Œ
    - [holiday-cn](https://github.com/NateScarlet/holiday-cn)ï¼šè‡ªåŠ¨æ¯æ—¥æŠ“å–å›½åŠ¡é™¢å…¬å‘Šï¼Œè¿”å›èŠ‚å‡æ—¥å’Œè¡¥ç­ä¿¡æ¯
    - [èŠ‚å‡æ—¥ API](http://timor.tech/api/holiday)ï¼šæ˜¯ç”±ç§äººç»´æŠ¤çš„APIï¼Œæ”¯æŒå¤šç§APIæ¥å£è®¿é—®ï¼Œä¼ å…¥æœˆä»½ã€ä¼ å…¥æ—¥æœŸã€ä¼ å…¥å¹´ä»½ç­‰ç­‰

    å¯¹äºç¬”è€…æ¥è¯´ï¼Œ[holiday-cn](https://github.com/NateScarlet/holiday-cn)å·²æ»¡è¶³ï¼Œæ•…è€Œç¬”è€…é€‰ç”¨äº†[holiday-cn](https://github.com/NateScarlet/holiday-cn)ã€‚å½“ç„¶å¦‚æœå…¬å¸æ”¯æŒï¼Œä¹Ÿå¯ä»¥åœ¨å…¬å¸æœåŠ¡ç«¯ç»´æŠ¤ä¸€ä»½èŠ‚å‡æ—¥ä¿¡æ¯ï¼Œèƒ½ä¿è¯å„ç«¯ç»Ÿä¸€ã€‚ç”šè‡³ä¹Ÿå¯ä»¥ç»´æŠ¤åœ¨å®¢æˆ·ç«¯ä¸€ä»½æœ¬åœ°jsonï¼Œç­‰ä¸‹ä¸€å¹´çš„èŠ‚å‡æ—¥ä¿¡æ¯å‡ºæ¥åï¼Œå†æ›´æ–°å®¢æˆ·ç«¯æœ¬åœ°çš„ã€‚

    è¿”å›èŠ‚å‡æ—¥JSONæ ¼å¼å¦‚ä¸‹ï¼Œ`name`æ˜¯èŠ‚å‡æ—¥åç§°ï¼Œ`date`æ˜¯èŠ‚å‡æ—¥æ—¥æœŸï¼Œ`isOffDay`ä»£è¡¨æ˜¯å¦æ˜¯ä¼‘æ¯ï¼Œæ¯”å¦‚`2021-09-18`æ˜¯ä¸­ç§‹èŠ‚çš„è¡¥ç­


    ``` JSON

    {
      "$schema":"https://raw.githubusercontent.com/NateScarlet/holiday-cn/master/schema.json",
      "$id":"https://raw.githubusercontent.com/NateScarlet/holiday-cn/master/2021.json",
      "year":2021,
      "papers":[
          "http://www.gov.cn/zhengce/content/2020-11/25/content_5564127.htm"
      ],
      "days":[
          {
              "name":"å…ƒæ—¦",
              "date":"2021-01-01",
              "isOffDay":true
          },
          {
              "name":"å…ƒæ—¦",
              "date":"2021-01-02",
              "isOffDay":true
          },
          {
              "name":"å…ƒæ—¦",
              "date":"2021-01-03",
              "isOffDay":true
          },
          {
              "name":"æ˜¥èŠ‚",
              "date":"2021-02-07",
              "isOffDay":false
          },
          {
              "name":"æ˜¥èŠ‚",
              "date":"2021-02-11",
              "isOffDay":true
          },
          {
              "name":"æ˜¥èŠ‚",
              "date":"2021-02-12",
              "isOffDay":true
          },
          {
              "name":"æ˜¥èŠ‚",
              "date":"2021-02-13",
              "isOffDay":true
          },
          {
              "name":"æ˜¥èŠ‚",
              "date":"2021-02-14",
              "isOffDay":true
          },
          {
              "name":"æ˜¥èŠ‚",
              "date":"2021-02-15",
              "isOffDay":true
          },
          {
              "name":"æ˜¥èŠ‚",
              "date":"2021-02-16",
              "isOffDay":true
          },
          {
              "name":"æ˜¥èŠ‚",
              "date":"2021-02-17",
              "isOffDay":true
          },
          {
              "name":"æ˜¥èŠ‚",
              "date":"2021-02-20",
              "isOffDay":false
          },
          {
              "name":"æ¸…æ˜èŠ‚",
              "date":"2021-04-03",
              "isOffDay":true
          },
          {
              "name":"æ¸…æ˜èŠ‚",
              "date":"2021-04-04",
              "isOffDay":true
          },
          {
              "name":"æ¸…æ˜èŠ‚",
              "date":"2021-04-05",
              "isOffDay":true
          },
          {
              "name":"åŠ³åŠ¨èŠ‚",
              "date":"2021-04-25",
              "isOffDay":false
          },
          {
              "name":"åŠ³åŠ¨èŠ‚",
              "date":"2021-05-01",
              "isOffDay":true
          },
          {
              "name":"åŠ³åŠ¨èŠ‚",
              "date":"2021-05-02",
              "isOffDay":true
          },
          {
              "name":"åŠ³åŠ¨èŠ‚",
              "date":"2021-05-03",
              "isOffDay":true
          },
          {
              "name":"åŠ³åŠ¨èŠ‚",
              "date":"2021-05-04",
              "isOffDay":true
          },
          {
              "name":"åŠ³åŠ¨èŠ‚",
              "date":"2021-05-05",
              "isOffDay":true
          },
          {
              "name":"åŠ³åŠ¨èŠ‚",
              "date":"2021-05-08",
              "isOffDay":false
          },
          {
              "name":"ç«¯åˆèŠ‚",
              "date":"2021-06-12",
              "isOffDay":true
          },
          {
              "name":"ç«¯åˆèŠ‚",
              "date":"2021-06-13",
              "isOffDay":true
          },
          {
              "name":"ç«¯åˆèŠ‚",
              "date":"2021-06-14",
              "isOffDay":true
          },
          {
              "name":"ä¸­ç§‹èŠ‚",
              "date":"2021-09-18",
              "isOffDay":false
          },
          {
              "name":"ä¸­ç§‹èŠ‚",
              "date":"2021-09-19",
              "isOffDay":true
          },
          {
              "name":"ä¸­ç§‹èŠ‚",
              "date":"2021-09-20",
              "isOffDay":true
          },
          {
              "name":"ä¸­ç§‹èŠ‚",
              "date":"2021-09-21",
              "isOffDay":true
          },
          {
              "name":"å›½åº†èŠ‚",
              "date":"2021-09-26",
              "isOffDay":false
          },
          {
              "name":"å›½åº†èŠ‚",
              "date":"2021-10-01",
              "isOffDay":true
          },
          {
              "name":"å›½åº†èŠ‚",
              "date":"2021-10-02",
              "isOffDay":true
          },
          {
              "name":"å›½åº†èŠ‚",
              "date":"2021-10-03",
              "isOffDay":true
          },
          {
              "name":"å›½åº†èŠ‚",
              "date":"2021-10-04",
              "isOffDay":true
          },
          {
              "name":"å›½åº†èŠ‚",
              "date":"2021-10-05",
              "isOffDay":true
          },
          {
              "name":"å›½åº†èŠ‚",
              "date":"2021-10-06",
              "isOffDay":true
          },
          {
              "name":"å›½åº†èŠ‚",
              "date":"2021-10-07",
              "isOffDay":true
          },
          {
              "name":"å›½åº†èŠ‚",
              "date":"2021-10-09",
              "isOffDay":false
          }
        ]
     }

    ```

    ä»£ç å¦‚ä¸‹

    ``` Swift

    fileprivate func filterHolidayInfo(with title: String?, location: String?, notes: String?, timeStr: String, eventKey: String) {
        guard let url = URL(string: "https://natescarlet.coding.net/p/github/d/holiday-cn/git/raw/master/2021.json") else {
            return
        }
        let task = URLSession.shared.dataTask(with: url) { [weak self] (data, response, error) in
            guard let data = data else { return }
            
            do {
                if let jsonResult = try JSONSerialization.jsonObject(with: data, options: JSONSerialization.ReadingOptions.mutableContainers) as? NSDictionary,
                   let days = jsonResult["days"] as? [NSDictionary] {
                    // è¿‡æ»¤èŠ‚å‡æ—¥
                    self?.handleHolidayInfo(with: days, title: title, location: location, notes: notes, timeStr: timeStr, eventKey: eventKey)
                }
            } catch {
                print(error)
            }
        }

        task.resume()
    }

    ```

2. â€œå¤šé€€å°‘è¡¥â€

    å³å±äºèŠ‚å‡æ—¥çš„å‘¨ä¸€è‡³å‘¨äº”çš„äº‹ä»¶ç§»é™¤ï¼Œå±äºè¡¥ç­çš„æ²¡æœ‰æ—¥å†äº‹ä»¶çš„åˆ™æ·»åŠ äº‹ä»¶ã€‚è¿™é‡Œéœ€è¦åˆ¤æ–­ï¼ŒæŸå¤©æ—¥æœŸæ˜¯å¦æœ‰å½“å‰çš„äº‹ä»¶ã€‚

    ``` Swift

    // åˆ¤æ–­æŸå¤©ï¼Œæ˜¯å¦æœ‰æŒ‡å®šçš„äº‹ä»¶
    fileprivate func eventExist(on tdate: Date?, eventKey: String) -> EKEvent? {
        var resultEvent: EKEvent?
        
        guard let date = tdate else {
            return resultEvent
        }
        
        let endDate = date.addingTimeInterval(TimeInterval(24 * 60 * 60))
        guard let calendarId = MKCalendarReminderUtil.userDefaultsSaveStr(kCustomCalendarId),
              let eventId = MKCalendarReminderUtil.userDefaultsSaveStr(eventKey),
              let calendar = store.calendar(withIdentifier: calendarId) else {
            return resultEvent
        }
        
        let predicate = store.predicateForEvents(withStart: date, end: endDate, calendars: [calendar])
        let events = store.events(matching: predicate)
        for event in events {
            if event.eventIdentifier == eventId {
                resultEvent = event
                break
            }
        }
        return resultEvent
    }

    // "å¤šé€€å°‘è¡¥"
    fileprivate func handleHolidayInfo(with days: [NSDictionary], title: String?, location: String?, notes: String?, timeStr: String, eventKey: String) {
        for dayDic in days {
            if let dayStr = dayDic["date"] as? String,
               let date = Date.date(from: dayStr, formatterStr: "yyyy-MM-dd"), // æ—¥æœŸ
               let isOffDay = dayDic["isOffDay"] as? Bool { // æ˜¯å¦ä¸Šç­
                let interval = date.timeIntervalSince(date)
                
                // 1. åˆ¤æ–­è·å–åˆ°çš„æ—¥æœŸå°äºå½“å‰æ—¥æœŸï¼Œè¯´æ˜æ˜¯ä»¥å‰çš„æ—¥æœŸï¼Œä¸å¤„ç†
                // 2. åˆ¤æ–­æ—¥æœŸå¤§äºç­‰äºå½“å‰æ—¥æœŸåï¼Œåˆ¤æ–­æ˜¯å¦ä¼‘æ¯ï¼Œåˆ¤æ–­æ—¥æœŸé‚£å¤©æ˜¯å¦æœ‰è¦æ·»åŠ çš„äº‹ä»¶ï¼Œ
                // 3. ä¼‘æ¯ï¼Œæœ‰äº‹ä»¶ï¼Œåˆ™ç§»é™¤äº‹ä»¶
                // 4. æœªä¼‘æ¯ï¼Œæ— äº‹ä»¶ï¼Œåˆ™æ·»åŠ äº‹ä»¶
                if interval < 0 {
                    continue
                }
                else {
                    if let targetEvent = eventExist(on: date, eventKey: eventKey) {
                        // äº‹ä»¶å­˜åœ¨
                        if isOffDay { // ä¼‘æ¯æ—¥
                            do {
                                try store.remove(targetEvent, span: EKSpan.thisEvent)
                            } catch {
                                print(error)
                            }
                        }
                    }
                    else {
                        // äº‹ä»¶ä¸å­˜åœ¨
                        if !isOffDay { // éä¼‘æ¯æ—¥ï¼Œå³è¦è¡¥ç­
                            let event = generateEvent(title, location: location, notes: notes, timeStr: timeStr)
                            do {
                                try store.save(event, span: EKSpan.thisEvent)
                            } catch {
                                print(error)
                            }
                        }
                    }
                }
            }
        }
    }

    ```

è¿™ä¸ªåœ°æ–¹è¿˜æœ‰ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼Œç¬”è€…åœ¨ç”Ÿæˆäº‹ä»¶`generateEvent`çš„æ–¹æ³•ä¸­ï¼Œæ·»åŠ äº†é‡å¤è§„åˆ™ï¼Œå¦‚æœä¸ä¿®æ”¹çš„è¯ï¼Œæœ€åä¼‘æ¯æ—¥è¡¥ç­è°ƒç”¨ç”Ÿæˆäº‹ä»¶æ–¹æ³•æ—¶ä¼šæœ‰é—®é¢˜ã€‚æ‰€ä»¥è¿™ä¸ªåœ°æ–¹è¦æŠŠäº‹ä»¶é‡å¤è§„åˆ™çš„é€»è¾‘ä»é€šç”¨çš„`generateEvent`æ–¹æ³•ä¸­æŠ½å‡ºæ¥ã€‚æ”¾åˆ°`addEvent`æ–¹æ³•çš„saveä¹‹å‰ã€‚

æœ€åè¿è¡Œè°ƒè¯•ï¼Œè°ƒç”¨ä»£ç å¦‚ä¸‹ï¼š

``` Swift

let date = Date.beijingDate()
let timeStr = Date.string(from: date, formatterStr: "yyyy-MM-dd HH:mm:ss")
MKCalendarReminderUtil.util.addEvent("è‡ªå®šä¹‰æ ‡é¢˜2", location: "ä¸Šæµ·ä¸œæ–¹æ˜ç 2", notes: "è®°å¾—æ‹ç…§æ‰“å¡2", timeStr: timeStr!, eventKey: "è‡ªå®šä¹‰æ ‡é¢˜2", filterHoliday: true)


```

æœ€ç»ˆç»“æœå¦‚ä¸‹ï¼š

<img src="https://i.loli.net/2021/05/14/RiMj5VZrnhKqvGt.png" width="50%" height="50%">

å¯ä»¥çœ‹åˆ°ä¸­ç§‹èŠ‚å’Œå›½åº†èŠ‚å‘¨ä¸€åˆ°å‘¨äº”çš„é€»è¾‘å¥½äº†ï¼Œä¹‹å‰æœ‰äº‹ä»¶çš„ç°åœ¨å·²ç»ç§»é™¤äº†ã€‚ä½†æ˜¯åº”è¯¥è¡¥ç­çš„ï¼Œæ¯”å¦‚9æœˆ18å’Œ9æœˆ26ï¼Œäº‹ä»¶å´æ²¡æœ‰åŠ ä¸Šï¼Ÿä»€ä¹ˆé¬¼ï¼Ÿéš¾é“æ˜¯æ·»åŠ äº‹ä»¶å¤±è´¥ï¼Ÿè°ƒè¯•åå‘ç°å¹¶æ²¡æœ‰ï¼Œäº‹ä»¶æ·»åŠ æ˜¯æˆåŠŸçš„ï¼Œä½†æ˜¯æ—¥å†ä¸­è¡¥ç­çš„æ—¥æœŸå´æ²¡æœ‰äº‹ä»¶ï¼Œå—¯å“¼ï¼Ÿ

å†å›è¿‡å¤´æ¥çœ‹è¡¥ç­æ·»åŠ äº‹ä»¶çš„é‚£æ®µä»£ç 

``` Swift 

// äº‹ä»¶ä¸å­˜åœ¨
if !isOffDay { // éä¼‘æ¯æ—¥ï¼Œå³è¦è¡¥ç­
    let event = generateEvent(title, location: location, notes: notes, timeStr: timeStr)
    do {
        try store.save(event, span: EKSpan.thisEvent)
    } catch {
        print(error)
    }
}

```

æ ¹æ®titleã€locationã€notesã€timeæ·»åŠ äº‹ä»¶ï¼Œå™¢...æ—¶é—´é”™äº†ï¼Œè¿™ä¸ªåœ°æ–¹åº”è¯¥æ·»åŠ çš„æ˜¯è¡¥ç­çš„æ—¥æœŸï¼Œè€Œä¸æ˜¯æœ€å¼€å§‹çš„æ—¥æœŸã€‚ã€‚ã€‚æ‰€ä»¥çœ‹ä¸€ä¸‹å½“å¤©æ—¥æœŸï¼Œåº”è¯¥èƒ½å‘ç°äº‹ä»¶éƒ½æ·»åŠ åˆ°é‚£å¤©é‡Œé¢äº†ã€‚

æ‰€ä»¥è¿™ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹ä¸ºï¼Œä»ä¼ å…¥æ—¥æœŸä¸­è·å–æ—¶åˆ†ç§’ï¼Œç„¶åæ‹¼æ¥ä¸Šè¡¥ç­çš„æ—¥æœŸï¼Œä½œä¸ºè¦è®¾ç½®çš„æ—¥æœŸï¼Œä¿®æ”¹å¦‚ä¸‹

``` Swift

// äº‹ä»¶ä¸å­˜åœ¨
if !isOffDay { // éä¼‘æ¯æ—¥ï¼Œå³è¦è¡¥ç­
    var targetDateStr = dayStr
    if let lastComponentStr = timeStr.components(separatedBy: " ").last {
        targetDateStr = String(format: "%@ %@", dayStr, lastComponentStr)
    }
    
    let event = generateEvent(title, location: location, notes: notes, timeStr: targetDateStr)
    do {
        try store.save(event, span: EKSpan.thisEvent)
    } catch {
        print(error)
    }
}

```

æœ€åï¼Œè°ƒè¯•è¿è¡Œï¼Œæˆè´¥åœ¨æ­¤ä¸€ä¸¾ï¼Œå“ˆå“ˆå“ˆï¼Œbinggoï¼Œå®Œç¾

<img src="https://i.loli.net/2021/05/14/u1P5b9eZrTNzJmy.png" width="50%" height="50%">

ä»£ç åœ°å€ï¼š[MKReminderUtil](https://github.com/mokong/MKReminderUtil)

### æ€»ç»“ï¼š

![WX20210514-171744.png](https://i.loli.net/2021/05/14/mJreAbHcWNziTSD.png)

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç”Ÿæˆçš„æ—¥å†æé†’ï¼Œè¿˜éœ€è¦è€ƒè™‘ä¸€ç‚¹ï¼Œå°±æ˜¯èŠ‚å‡æ—¥æ•°æ®æœ‰æ›´æ–°çš„æ—¶å€™ï¼Œå¦‚ä½•æ›´æ–°ï¼Ÿç¬”è€…è¿™é‡Œæ„Ÿè§‰å¦‚æœæ˜¯åœ¨è‡ªå·±æœåŠ¡ç«¯ç»´æŠ¤ä¸€å¥—èŠ‚å‡æ—¥æ•°æ®æ¯”è¾ƒå¥½ï¼Œè¿”å›èŠ‚å‡æ—¥æ•°æ®æ—¶ï¼Œä¹Ÿè¿”å›å¯¹åº”ç‰ˆæœ¬å·ã€‚è¿™æ ·è¯·æ±‚äº†ä¹‹åï¼Œæ ¹æ®versionå¯¹æ¯”ï¼Œå¦‚æœèŠ‚å‡æ—¥æ•°æ®æ²¡æœ‰æ›´æ–°ï¼Œåˆ™æ— éœ€åšä»»ä½•æ“ä½œï¼Œå¦‚æœæœ‰æ›´æ–°ï¼Œåˆ™æ ¹æ®æ›´æ–°çš„æ•°æ®é»˜é»˜çš„æŠŠæ˜å¹´çš„æ—¥å†ä¹Ÿåˆ›å»ºäº†å³å¯ã€‚

## å‚è€ƒ

- [Creating a Recurring Event](https://developer.apple.com/documentation/eventkit/ekrecurrencerule)
- [ios â€“ å¦‚ä½•ä»æ—¥å†ä¸­è·å–æ‰€æœ‰äº‹ä»¶(Swift)](http://www.voidcn.com/article/p-bwvrwkpr-bwd.html)
- [holiday-cn](https://github.com/NateScarlet/holiday-cn)
- [èŠ‚å‡æ—¥ API](http://timor.tech/api/holiday)

